p8105\_hw6\_sal2222
================
Stephen Lewandowski
November 16, 2018

### Problem 1 - Homicide data

This problem utilizes data from *The Washington Post* on homicides in 50 U.S. cities. The code chunk below imports and cleans the data. I referred to the posted solution of Homework 5, Problem 2 for some of the data cleaning code structure and naming conventions.

``` r
homicide_df <- 
  read_csv("data/homicide-data.csv", na = c("", "NA", "Unknown")) %>%
  mutate(
    city_state = str_c(city, state, sep = ", "),
    resolution = factor(case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved"
    )),
    victim_race = factor(case_when(
      victim_race == "White" ~ "white",
      victim_race != "white" ~ "non-white"
    )),
    victim_race = fct_relevel(victim_race, "white"),
    victim_age = as.numeric(victim_age),
    victim_sex = factor(victim_sex)) %>% 
  filter(!city_state %in% c("Tulsa, AL", "Dallas, TX", "Phoenix, AZ", "Kansas City, MO")) 
## Parsed with column specification:
## cols(
##   uid = col_character(),
##   reported_date = col_integer(),
##   victim_last = col_character(),
##   victim_first = col_character(),
##   victim_race = col_character(),
##   victim_age = col_integer(),
##   victim_sex = col_character(),
##   city = col_character(),
##   state = col_character(),
##   lat = col_double(),
##   lon = col_double(),
##   disposition = col_character()
## )
```

I excluded cities that do not report race as well as a data entry error ("Tulsa, AL").

For the city of Baltimore, MD, use the glm function to fit a logistic regression with resolved vs unresolved as the outcome and victim age, sex and race (as just defined) as predictors. Save the output of glm as an R object; apply the broom::tidy to this object; and obtain the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing black victims to white victims keeping all other variables fixed.

``` r

fit_logistic <- 
  homicide_df %>% 
    filter(city_state == "Baltimore, MD") %>% 
    select(resolution, victim_age, victim_race, victim_sex) %>% 
    glm(resolution ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 
```

``` r

broom::tidy(fit_logistic, conf.int = TRUE) %>% 
  mutate(OR = exp(estimate),
         conf_low_OR = exp(conf.low),
         conf_high_OR = exp(conf.high)) %>%
  select(term, log_OR = estimate, OR, conf_low_OR, conf_high_OR) %>% 
  knitr::kable(digits = 3)
```

| term                  |  log\_OR|     OR|  conf\_low\_OR|  conf\_high\_OR|
|:----------------------|--------:|------:|--------------:|---------------:|
| (Intercept)           |   -1.186|  0.305|          0.192|           0.482|
| victim\_age           |    0.007|  1.007|          1.001|           1.014|
| victim\_racenon-white |    0.820|  2.270|          1.614|           3.203|
| victim\_sexMale       |    0.888|  2.430|          1.862|           3.176|

In the next code chunk, I group within cities and summarize to produce the total number of homicides and the number that are solved.

``` r
city_homicide_df = 
  homicide_df %>% 
  select(city_state, disposition, resolution) %>% 
  group_by(city_state) %>% 
  summarize(hom_total = n(),
            hom_unsolved = sum(resolution == "unsolved"))
```

Focusing only on Baltimore, MD, I can use the `prop.test` and `broom::tidy` functions to obtain an estimate and CI of the proportion of unsolved homicides in that city. The table below shows those values.

``` r
bmore_test = 
  prop.test(x = filter(city_homicide_df, city_state == "Baltimore, MD") %>% pull(hom_unsolved),
            n = filter(city_homicide_df, city_state == "Baltimore, MD") %>% pull(hom_total)) 

broom::tidy(bmore_test) %>% 
  knitr::kable(digits = 3)
```

|  estimate|  statistic|  p.value|  parameter|  conf.low|  conf.high| method                                               | alternative |
|---------:|----------:|--------:|----------:|---------:|----------:|:-----------------------------------------------------|:------------|
|     0.646|    239.011|        0|          1|     0.628|      0.663| 1-sample proportions test with continuity correction | two.sided   |

### Problem 2 - Birthweight data

I will now load and clean birthweight data for 4,342 children for regression analysis.

``` r
birthweight_df <- 
  read_csv("data/birthweight.csv") %>% 
  mutate(
      babysex = factor(babysex),
      frace = factor(frace),
      malform = factor(malform),
      mrace = factor(mrace)
  )
## Parsed with column specification:
## cols(
##   .default = col_integer(),
##   gaweeks = col_double(),
##   ppbmi = col_double(),
##   smoken = col_double()
## )
## See spec(...) for full column specifications.
```

There is no missing data.

``` r
birthweight_df %>% 
  is.na() %>% summary()
##   babysex          bhead          blength           bwt         
##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  
##  FALSE:4342      FALSE:4342      FALSE:4342      FALSE:4342     
##    delwt          fincome          frace          gaweeks       
##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  
##  FALSE:4342      FALSE:4342      FALSE:4342      FALSE:4342     
##   malform         menarche        mheight          momage       
##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  
##  FALSE:4342      FALSE:4342      FALSE:4342      FALSE:4342     
##    mrace           parity         pnumlbw         pnumsga       
##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  
##  FALSE:4342      FALSE:4342      FALSE:4342      FALSE:4342     
##    ppbmi            ppwt           smoken          wtgain       
##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  
##  FALSE:4342      FALSE:4342      FALSE:4342      FALSE:4342
```

Proposed regression model for birthweight
-----------------------------------------

Model comparison
----------------

``` r
lm(bwt ~ blength + gaweeks, data = birthweight_df) %>% broom::tidy()
## # A tibble: 3 x 5
##   term        estimate std.error statistic  p.value
##   <chr>          <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)  -4348.      98.0      -44.4 0.      
## 2 blength        129.       1.99      64.6 0.      
## 3 gaweeks         27.0      1.72      15.7 2.36e-54
```

``` r

lm(bwt ~ bhead + blength + babysex + (bhead * blength) + (blength * babysex) + (bhead * babysex) +
     (bhead * blength * babysex), data = birthweight_df) %>% 
      broom::tidy()
## # A tibble: 8 x 5
##   term                    estimate std.error statistic      p.value
##   <chr>                      <dbl>     <dbl>     <dbl>        <dbl>
## 1 (Intercept)            -7177.     1265.       -5.67  0.0000000149
## 2 bhead                    182.       38.1       4.78  0.00000184  
## 3 blength                  102.       26.2       3.90  0.0000992   
## 4 babysex2                6375.     1678.        3.80  0.000147    
## 5 bhead:blength             -0.554     0.780    -0.710 0.478       
## 6 blength:babysex2        -124.       35.1      -3.52  0.000429    
## 7 bhead:babysex2          -198.       51.1      -3.88  0.000105    
## 8 bhead:blength:babysex2     3.88      1.06      3.67  0.000245
```

Make this comparison in terms of the cross-validated prediction error; use crossv\_mc and functions in purrr as appropriate.
